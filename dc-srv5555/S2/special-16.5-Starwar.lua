--村规决斗：星球大战
--开局时，双方将1张【星球改造】（73628505）从卡组外表侧表示除外。
--这场决斗中这张卡不是表侧表示除外的场合，这张卡表侧表示除外。
--这张卡得到以下效果。
--1回合最多10次，自己主要阶段才能发动这个效果。这个效果的发动和效果不会被无效化。
--从卡组外将1张随机场地卡在自己场上发动。

CUNGUI = {}

function Auxiliary.PreloadUds()
	--adjust
	local e1=Effect.GlobalEffect()
	e1:SetType(EFFECT_TYPE_FIELD+EFFECT_TYPE_CONTINUOUS)
	e1:SetProperty(EFFECT_FLAG_IGNORE_IMMUNE)
	e1:SetCode(EVENT_ADJUST)
	e1:SetOperation(CUNGUI.AdjustOperation)
	Duel.RegisterEffect(e1,0)
end
function CUNGUI.AdjustOperation()
	if not CUNGUI.INIT then
		CUNGUI.INIT = true
		CUNGUI.RegisterCardRule(0)
		CUNGUI.RegisterCardRule(1)
		math.random = Duel.GetRandomNumber
	end
	if CUNGUI.RuleCard[0] and (not CUNGUI.RuleCard[0]:IsLocation(LOCATION_REMOVED) or not CUNGUI.RuleCard[0]:IsFaceup()) then
		Duel.Remove(CUNGUI.RuleCard[0],POS_FACEUP,REASON_RULE)
	end
	if CUNGUI.RuleCard[1] and (not CUNGUI.RuleCard[1]:IsLocation(LOCATION_REMOVED) or not CUNGUI.RuleCard[1]:IsFaceup()) then
		Duel.Remove(CUNGUI.RuleCard[1],POS_FACEUP,REASON_RULE)
	end
	if CUNGUI.RuleCard[0] and not CUNGUI.RuleCard[0]:IsFaceup() then
		Duel.ChangePosition(CUNGUI.RuleCard[0],POS_FACEUP)
	end
	if CUNGUI.RuleCard[1] and not CUNGUI.RuleCard[1]:IsFaceup() then
		Duel.ChangePosition(CUNGUI.RuleCard[1],POS_FACEUP)
	end
end

CUNGUI.RuleCard={}
CUNGUI.FieldCards={269012,269510,295517,575512,675319,712559,975299,1003840,1050355,1061200,1127737,1295111,1801154,2084239,2106266,2144946,2819435,3113667,3576031,3875465,4064256,4215636,4357063,4545854,4740489,5050644,5697558,5833312,6909330,7142724,7617062,9547962,9989792,10080320,10424147,11102908,12215894,12644061,12931061,13035077,13301895,13482262,13764602,14001430,14289852,15854426,16269385,16625614,17000165,17228908,18114794,18161786,18720257,18890039,19162134,19384334,19814508,20216608,20720928,22198672,22555834,22702055,22751868,22829942,23160024,23213239,23377425,23424603,24382602,24793135,25163979,26232916,26493435,26534688,26920296,27564031,27813661,28120197,28126717,28388296,29400787,29650040,30761649,32354768,32391631,32999573,33017655,33550694,33773528,33814281,33900648,33981008,34103656,34487429,34572613,34822850,35371948,35487920,35546670,35815783,35956022,36099620,36668118,37322745,37694547,38053381,38057522,39730727,39838559,39910367,40005099,40089744,41128647,41418852,42015635,42461852,43034264,43175858,43912676,43940008,44139064,44352516,44710391,45383307,45778932,45943516,46500985,46552140,47355498,47596607,47679935,47870325,48015771,48179391,50005218,50186558,50433147,50913601,51208046,52518793,53039326,53527835,53819808,54250060,54306223,54631665,55553602,55742055,56063182,56074358,56111151,56433456,56594520,57554544,58012707,58406094,58793369,58924378,59048135,59054773,59160188,59197169,59687381,60448701,60514625,60884672,60946968,61557074,61583217,61654098,62188962,62200831,62265044,63035430,63492244,63883999,64213017,64230128,64400161,65589010,65959844,66399653,66750703,67237709,67328336,67331360,67616300,67831115,68462976,69039982,69217334,69296555,69408987,70122149,70222318,70422863,71645242,71650854,72043279,72283691,72772445,73206827,73787254,74665651,75041269,75304793,75782277,76136345,76375976,76473843,76871889,77297908,77584012,78082039,79555535,79698395,80921533,81231742,81380218,81777047,81788994,82999629,84171830,84335863,84504242,84792926,85638822,85668449,86318356,86643777,86997073,87430998,87624166,87902575,89264428,90011152,90173539,90351981,91027843,91228233,92223430,92481084,93031067,94243005,94317736,94585852,95376428,95477924,95658967,95856586,99543666,99795159}

function CUNGUI.RegisterCardRule(tp)
	local c=Duel.CreateToken(tp,73628505)
	Duel.Remove(c,POS_FACEUP,REASON_RULE)
	CUNGUI.RuleCard[tp]=c
	--forbid
	local e1=Effect.CreateEffect(c)
	e1:SetDescription(aux.Stringid(66666004,4))
	e1:SetType(EFFECT_TYPE_IGNITION)
	e1:SetCountLimit(10)
	e1:SetProperty(EFFECT_FLAG_CANNOT_INACTIVATE+EFFECT_FLAG_CAN_FORBIDDEN+EFFECT_FLAG_CANNOT_DISABLE)
	e1:SetRange(LOCATION_REMOVED)
	e1:SetOperation(CUNGUI.ruleop)
	c:RegisterEffect(e1)
end

function CUNGUI.ruleop(e,tp,eg,ep,ev,re,r,rp)
	local tc=Duel.CreateToken(tp,CUNGUI.FieldCards[math.random(#CUNGUI.FieldCards)])
	local te=tc:GetActivateEffect()
	local fc=Duel.GetFieldCard(tp,LOCATION_FZONE,0)
	if fc then
		Duel.SendtoGrave(fc,REASON_RULE)
		Duel.BreakEffect()
	end
	Duel.MoveToField(tc,tp,tp,LOCATION_FZONE,POS_FACEUP,true)
	te:UseCountLimit(tp,1,true)
	local tep=tc:GetControler()
	local cost=te:GetCost()
	if cost then cost(te,tep,eg,ep,ev,re,r,rp,1) end
	Duel.RaiseEvent(tc,4179255,te,0,tp,tp,Duel.GetCurrentChain())
end

