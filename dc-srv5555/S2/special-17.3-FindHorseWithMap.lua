--村规决斗：按图索骥
--开局时，双方将1张大融合（7614732）从卡组外表侧表示除外。
--这场决斗中这张卡不是表侧表示除外的场合，这张卡表侧表示除外。
--这张卡得到以下效果。
--1回合1次，这张卡在除外的状态才能发动。这个效果的发动和效果不会被无效化。
--将1张随机融合怪兽卡从卡组外加入额外卡组，
--那张卡上记载的所有卡名的卡各1张
--和1张【融合】（24094653）从卡组外加入手卡·额外卡组。

CUNGUI = {}

function Auxiliary.PreloadUds()
	--adjust
	local e1=Effect.GlobalEffect()
	e1:SetType(EFFECT_TYPE_FIELD+EFFECT_TYPE_CONTINUOUS)
	e1:SetProperty(EFFECT_FLAG_IGNORE_IMMUNE)
	e1:SetCode(EVENT_ADJUST)
	e1:SetOperation(CUNGUI.AdjustOperation)
	Duel.RegisterEffect(e1,0)
end
function CUNGUI.AdjustOperation()
	if not CUNGUI.INIT then
		CUNGUI.INIT = true
		CUNGUI.RegisterCardRule(0)
		CUNGUI.RegisterCardRule(1)
		math.random = Duel.GetRandomNumber
	end
	if CUNGUI.RuleCard[0] and (not CUNGUI.RuleCard[0]:IsLocation(LOCATION_REMOVED) or not CUNGUI.RuleCard[0]:IsFaceup()) then
		Duel.Remove(CUNGUI.RuleCard[0],POS_FACEUP,REASON_RULE)
	end
	if CUNGUI.RuleCard[1] and (not CUNGUI.RuleCard[1]:IsLocation(LOCATION_REMOVED) or not CUNGUI.RuleCard[1]:IsFaceup()) then
		Duel.Remove(CUNGUI.RuleCard[1],POS_FACEUP,REASON_RULE)
	end
	if CUNGUI.RuleCard[0] and not CUNGUI.RuleCard[0]:IsFaceup() then
		Duel.ChangePosition(CUNGUI.RuleCard[0],POS_FACEUP)
	end
	if CUNGUI.RuleCard[1] and not CUNGUI.RuleCard[1]:IsFaceup() then
		Duel.ChangePosition(CUNGUI.RuleCard[1],POS_FACEUP)
	end
end

CUNGUI.RuleCard={}
CUNGUI.FusionCards={284224,464362,1412158,1516510,1546123,1546124,1561110,1641882,1906812,1945387,2111707,2129638,2504891,2519690,3113836,3366982,3410461,3544583,3642509,3779662,3897065,4167084,4591250,4628897,4688231,4796100,5128859,5368615,5600127,6150044,6150045,6182103,6602300,6840573,6855503,7243511,7631534,8198620,8327462,8463720,8692301,9293977,9603252,9653271,9910360,10040267,10248389,10365322,10383554,10526791,10817524,10920352,10960419,11039171,11270236,11321089,11443677,11502550,11901678,12015000,12307878,12652643,12678870,13108445,13293158,13331639,13529466,13722870,13735899,13756293,13803864,13857930,14017402,14225239,15237615,15291624,15661378,15989522,16006416,16114248,16304628,16507828,17032740,17412721,17745969,17881964,18313046,18386170,18514525,18666161,18832779,18967507,19066538,19261966,19355597,19747827,20366274,20366275,21113684,21140872,21175632,21225115,21947653,22061412,22070401,22093873,22160245,22638495,22804644,22900219,22908820,23204029,23995346,23995347,23995348,24550676,24672164,24799107,25119460,25366484,25586143,25655502,25793414,26273196,27134689,27346636,27873305,28016193,28593363,28677304,29095552,29343734,29357956,29455728,29929832,30086349,30757127,30864377,31111109,31339260,32355828,32485271,32615065,32751480,32752319,32775808,32828466,33026283,33129626,33250142,33574806,33652635,33691040,33964637,34848821,35187185,35752363,35809262,35877582,36256625,36841733,37057012,37261776,37421579,37440988,37491810,37542782,37663536,37678339,37818794,39512984,39915560,40080312,40101111,40173854,40391316,40418351,40636712,40854197,41209827,41209828,41232647,41373230,41436536,41462083,41462084,41517968,41544074,41578483,41685633,41721210,42166000,42717221,43228023,43378048,43387895,43892408,43892409,44146295,44373896,44509529,45014450,45170821,45231177,45231178,45349196,45655875,46354113,46696593,46759931,47611119,47737087,48063985,48156348,48424886,48791583,48832775,48996569,49161188,49352945,49513164,49597193,49820233,49868263,50237654,50282757,50608164,50855622,50907446,51570882,51777272,51788412,51828629,52031567,53262004,53315891,53539634,54401832,54541900,54622031,54702678,54752875,54757758,55171412,55615891,56413937,56532353,56655675,56907389,57157964,57477163,57594700,58147549,58293343,58332301,58468105,58481572,58528964,58601383,58859575,59036972,59255742,59531356,59642500,60110982,60237530,60461804,60493189,61204971,62111090,62624486,62873545,63519819,64463828,64599569,64655485,65029288,65172015,66235877,66309175,66889139,67985943,68507541,68745629,69394324,69946549,70219023,70534340,70681994,71159974,71616908,71628381,72064891,72272462,72378329,72664875,72869010,72926163,72959823,73285669,73452089,74009824,74157028,74506079,74583607,74703140,74711057,74822425,74889525,74936480,75286621,75380687,75906310,75923050,76263644,76614340,76815942,77693536,78084378,78512663,78734254,78778375,79194594,79206925,79229522,79864860,80071763,80516007,80532587,80727036,80889750,81003500,81197327,81566151,81612598,81997228,82315403,82734805,82956492,83121692,83340560,83656563,83743222,83866861,84058253,84243274,84433295,84569886,84687358,84988419,85059922,85507811,85545073,85684223,85908279,86099788,86164529,86165817,86240887,86274272,86346643,86520461,86676862,86805855,87116928,87182127,87746184,87751584,88305705,88753594,88820235,89112729,89870349,90050480,90140980,90307498,90555947,90579153,90660762,90957527,91034681,91272072,91998119,91998120,91998121,92798873,92892239,93379652,93657021,93729065,93877990,94566432,94905343,94977269,94977270,95144193,95463814,95486586,95793022,95952802,96220350,96334243,96897184,97165977,97300502,98502113,98502114,98502115,98927491,99267150,99267151,99551425,99724761,99916754}

function CUNGUI.RegisterCardRule(tp)
	local c=Duel.CreateToken(tp,7614732)
	Duel.Remove(c,POS_FACEUP,REASON_RULE)
	CUNGUI.RuleCard[tp]=c
	--forbid
	local e1=Effect.CreateEffect(c)
	e1:SetDescription(aux.Stringid(66666004,4))
	e1:SetType(EFFECT_TYPE_IGNITION)
	e1:SetCountLimit(1)
	e1:SetProperty(EFFECT_FLAG_CANNOT_INACTIVATE+EFFECT_FLAG_CAN_FORBIDDEN+EFFECT_FLAG_CANNOT_DISABLE)
	e1:SetRange(LOCATION_REMOVED)
	e1:SetOperation(CUNGUI.ruleop)
	c:RegisterEffect(e1)
end

function CUNGUI.ruleop(e,tp,eg,ep,ev,re,r,rp)
	local index=#CUNGUI.FusionCards
	local code=CUNGUI.FusionCards[math.random(index)]
	local c=Duel.CreateToken(tp,code)
	Duel.SendtoDeck(c,nil,2,REASON_EFFECT)
	local fc=Duel.CreateToken(tp,24094653)
	Duel.SendtoHand(fc,nil,REASON_EFFECT)
	if not c.card_code_list then return end
	for lcode,_ in pairs(c.card_code_list) do
		local tc=Duel.CreateToken(tp,lcode)
		Duel.SendtoHand(tc,tp,REASON_EFFECT)
	end
end

